name = "w2-checkout-worker"
main = "src/index.js"
compatibility_date = "2025-11-15"
compatibility_flags = ["nodejs_compat"]


# Do not store private keys in vars for production. Use `wrangler secret put`.
[vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
PRICING_WORKER_URL = "https://w2-pricing-worker.vg-firmly.workers.dev"
INVENTORY_WORKER_URL = "https://w2-inventory-worker.vg-firmly.workers.dev" 


#PRICING_SERVICE_TOKEN = `VPzxLDdSpE0EfyX/h9HnRxTQ2rIegJC/ilXw74dY1YE=`

# Service token for inter-worker authentication (set as secret: wrangler secret put PRICING_SERVICE_TOKEN)
# Must match the token used by Catalog Worker
# PRICING_SERVICE_TOKEN = "your-service-token-here"
# Example (commented out)
# PEPPER = "replace-me-locally"

# D1 database binding (top-level)
[[d1_databases]]
binding = "CHECKOUT_DB"
database_name = "checkout_db"
database_id = "59778a80-01e5-4c6b-8de0-38264e51efdd"
#preview_database_id = "8cdf8da1-4036-4dcf-8e3a-c59dc91facd8"

# Service bindings to other Workers
[[services]]
binding = "PRICING_WORKER"
service = "w2-pricing-worker"

[[services]]
binding = "INVENTORY_WORKER"
service = "w2-inventory-worker"

[[services]]
binding = "CART_WORKER"
service = "w2-cart-worker"

# KV namespace for stock reservations (critical for preventing overselling)
[[kv_namespaces]]
binding = "CHECKOUT_KV"
id = "b52b3398ed5e40f7bd92bd665e817752"

# Catalog Worker URL for reference (if needed for validation)
# CATALOG_WORKER_URL = "http://localhost:8787"

# R2 bucket for product images
#[[r2_buckets]]
#binding = "CA_IMG_BUCKET"
#bucket_name = "catalog-img-bucket"





