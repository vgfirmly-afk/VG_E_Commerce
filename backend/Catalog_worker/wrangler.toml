name = "w2-catalog-worker"
main = "src/index.js"
compatibility_date = "2025-11-15"
compatibility_flags = ["nodejs_compat"]

# Do not store private keys in vars for production. Use `wrangler secret put`.
[vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
# Pricing Worker URL for inter-worker communication
PRICING_WORKER_URL = "http://localhost:49861"
#"https://w2-pricing-worker.vg-firmly.workers.dev"
# Catalog Worker URL (sent as X-Source header for whitelisting)
CATALOG_WORKER_URL = "https://w2-catalog-worker.vg-firmly.workers.dev"
# Service token for inter-worker authentication (set as secret: wrangler secret put PRICING_SERVICE_TOKEN)
# PRICING_SERVICE_TOKEN = "your-service-token-here"
# Example (commented out)
# PEPPER = "replace-me-locally"

# D1 database binding (top-level)
[[d1_databases]]
binding = "CATALOG_DB"
database_name = "catalog_db"
database_id = "fa358bd9-0c52-49aa-b0ce-302302d9be1c"
preview_database_id = "1dbd0b02-4193-42a9-a3fc-59d8969d319a"

# KV namespace (production and preview)
[[kv_namespaces]]
binding = "CATALOG_KV"
id = "ca68f8f4ec1d4eef8065287d94993ee5"
preview_id = "52e2b42be95141bdb35ad3b4c93338cf"

# R2 bucket for product images
[[r2_buckets]]
binding = "CATALOG_IMG_BUCKET"
bucket_name = "catalog-img-bucket"
preview_bucket_name = "catalog-img-bucket-preview"

# Service binding to Pricing Worker (for direct Worker-to-Worker communication)
[[services]]
binding = "PRICING_WORKER"
service = "w2-pricing-worker"

# Service binding to Inventory Worker (for direct Worker-to-Worker communication)
[[services]]
binding = "INVENTORY_WORKER"
service = "w2-inventory-worker"

# --------------------------
# staging environment
# --------------------------
[env.staging]
name = "stageenv-w2-catalog-worker"

[env.staging.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
PRICING_WORKER_URL = "https://stageenv-w2-pricing-worker.vg-firmly.workers.dev"
CATALOG_WORKER_URL = "https://stageenv-w2-catalog-worker.vg-firmly.workers.dev"

[[env.staging.d1_databases]]
binding = "CATALOG_DB"
database_name = "catalog_db"
database_id = "fa358bd9-0c52-49aa-b0ce-302302d9be1c"

[[env.staging.kv_namespaces]]
binding = "CATALOG_KV"
id = "ca68f8f4ec1d4eef8065287d94993ee5"

[[env.staging.r2_buckets]]
binding = "CATALOG_IMG_BUCKET"
bucket_name = "catalog-img-bucket"

[[env.staging.services]]
binding = "PRICING_WORKER"
service = "stageenv-w2-pricing-worker"

[[env.staging.services]]
binding = "INVENTORY_WORKER"
service = "stageenv-w2-inventory-worker"

# --------------------------
# dev environment
# --------------------------
[env.dev]
name = "devenv-w2-catalog-worker"

[env.dev.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
PRICING_WORKER_URL = "http://localhost:49861"
CATALOG_WORKER_URL = "https://devenv-w2-catalog-worker.vg-firmly.workers.dev"

[[env.dev.d1_databases]]
binding = "CATALOG_DB"
database_name = "catalog_db"
database_id = "fa358bd9-0c52-49aa-b0ce-302302d9be1c"

[[env.dev.kv_namespaces]]
binding = "CATALOG_KV"
id = "ca68f8f4ec1d4eef8065287d94993ee5"

[[env.dev.r2_buckets]]
binding = "CATALOG_IMG_BUCKET"
bucket_name = "catalog-img-bucket-preview"

[[env.dev.services]]
binding = "PRICING_WORKER"
service = "devenv-w2-pricing-worker"

[[env.dev.services]]
binding = "INVENTORY_WORKER"
service = "devenv-w2-inventory-worker"

# --------------------------
# prod environment
# --------------------------
[env.prod]
name = "w2-catalog-worker"

[env.prod.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
PRICING_WORKER_URL = "https://w2-pricing-worker.vg-firmly.workers.dev"
CATALOG_WORKER_URL = "https://w2-catalog-worker.vg-firmly.workers.dev"

[[env.prod.d1_databases]]
binding = "CATALOG_DB"
database_name = "catalog_db"
database_id = "fa358bd9-0c52-49aa-b0ce-302302d9be1c"

[[env.prod.kv_namespaces]]
binding = "CATALOG_KV"
id = "ca68f8f4ec1d4eef8065287d94993ee5"

[[env.prod.r2_buckets]]
binding = "CATALOG_IMG_BUCKET"
bucket_name = "catalog-img-bucket"

[[env.prod.services]]
binding = "PRICING_WORKER"
service = "w2-pricing-worker"

[[env.prod.services]]
binding = "INVENTORY_WORKER"
service = "w2-inventory-worker"





