name = "w2-payment-worker"
main = "src/index.js"
compatibility_date = "2025-11-09"
compatibility_flags = ["nodejs_compat"]
workers_dev = true
#preview_urls = true

# Do not store private keys in vars for production. Use `wrangler secret put`.
[vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
SERVICE_NAME = "Payment_Worker_Service"

# PayPal credentials - DO NOT store in vars for production!
# Use: wrangler secret put PAYPAL_CLIENT_ID
# Use: wrangler secret put PAYPAL_CLIENT_SECRET
# For local dev only, you can uncomment and set:
# PAYPAL_CLIENT_ID = "ATs9BSAXJChAJBAA4bYF2rAwVrAuxrIuGkSTGxFZ6-NsJDn11hOK2crEXSYxYIlOzyKoFgsKJIg9w9z8"
# PAYPAL_CLIENT_SECRET = "EPGEA5-oYft0UO1FJnmpY8vgjFoxvNVUj69iXlyOmZoS1r6ue4diEmAnlUBM0OUvktgZhX0kKuRag5dQ"

# D1 database binding (top-level)
[[d1_databases]]
binding = "PAYMENT_DB"
database_name = "payment_db"
database_id = "7d7799f2-2bd4-4f52-a7ce-ffe72ddc262b"
#preview_database_id = "8cdf8da1-4036-4dcf-8e3a-c59dc91facd8"

# Service bindings to other Workers
[[services]]
binding = "CHECKOUT_WORKER"
service = "w2-checkout-worker"

[[services]]
binding = "INVENTORY_WORKER"
service = "w2-inventory-worker"

[[services]]
binding = "FULFILLMENT_WORKER"
service = "w2-fullfillment-worker"

[[services]]
binding = "CATALOG_WORKER"
service = "w2-catalog-worker"

[[services]]
binding = "CART_WORKER"
service = "w2-cart-worker"

# Frontend URLs for payment redirects
# Set these in wrangler.toml or as environment variables
# FRONTEND_SUCCESS_URL = "https://your-frontend.com/payment/success"
# FRONTEND_FAILURE_URL = "https://your-frontend.com/payment/failure"

# Catalog Worker URL for reference (if needed for validation)
# CATALOG_WORKER_URL = "http://localhost:8787"

# R2 bucket for product images
#[[r2_buckets]]
#binding = "CA_IMG_BUCKET"
#bucket_name = "catalog-img-bucket"

# --------------------------
# staging environment
# --------------------------
[env.staging]
name = "stageenv-w2-payment-worker"

[env.staging.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
SERVICE_NAME = "Payment_Worker_Service"

[[env.staging.d1_databases]]
binding = "PAYMENT_DB"
database_name = "payment_db"
database_id = "7d7799f2-2bd4-4f52-a7ce-ffe72ddc262b"

[[env.staging.services]]
binding = "CHECKOUT_WORKER"
service = "stageenv-w2-checkout-worker"

[[env.staging.services]]
binding = "INVENTORY_WORKER"
service = "stageenv-w2-inventory-worker"

[[env.staging.services]]
binding = "FULFILLMENT_WORKER"
service = "stageenv-w2-fullfillment-worker"

[[env.staging.services]]
binding = "CATALOG_WORKER"
service = "stageenv-w2-catalog-worker"

[[env.staging.services]]
binding = "CART_WORKER"
service = "stageenv-w2-cart-worker"

# --------------------------
# dev environment
# --------------------------
[env.dev]
name = "devenv-w2-payment-worker"

[env.dev.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
SERVICE_NAME = "Payment_Worker_Service"

[[env.dev.d1_databases]]
binding = "PAYMENT_DB"
database_name = "payment_db"
database_id = "7d7799f2-2bd4-4f52-a7ce-ffe72ddc262b"

[[env.dev.services]]
binding = "CHECKOUT_WORKER"
service = "devenv-w2-checkout-worker"

[[env.dev.services]]
binding = "INVENTORY_WORKER"
service = "devenv-w2-inventory-worker"

[[env.dev.services]]
binding = "FULFILLMENT_WORKER"
service = "devenv-w2-fullfillment-worker"

[[env.dev.services]]
binding = "CATALOG_WORKER"
service = "devenv-w2-catalog-worker"

[[env.dev.services]]
binding = "CART_WORKER"
service = "devenv-w2-cart-worker"

# --------------------------
# prod environment
# --------------------------
[env.prod]
name = "w2-payment-worker"

[env.prod.vars]
HONEYCOMB_API_KEY = "hcaik_01ka4fnfh58axt6bp5df489adwdrerncqa3hqbk39dxxrvaa1vp62cgkse"
HONEYCOMB_DATASET = "Week_Two_Main_Project"
SERVICE_NAME = "Payment_Worker_Service"

[[env.prod.d1_databases]]
binding = "PAYMENT_DB"
database_name = "payment_db"
database_id = "7d7799f2-2bd4-4f52-a7ce-ffe72ddc262b"

[[env.prod.services]]
binding = "CHECKOUT_WORKER"
service = "w2-checkout-worker"

[[env.prod.services]]
binding = "INVENTORY_WORKER"
service = "w2-inventory-worker"

[[env.prod.services]]
binding = "FULFILLMENT_WORKER"
service = "w2-fullfillment-worker"

[[env.prod.services]]
binding = "CATALOG_WORKER"
service = "w2-catalog-worker"

[[env.prod.services]]
binding = "CART_WORKER"
service = "w2-cart-worker"





