import ts from 'typescript';
import { IMPORT_MODIFIERS, IMPORT_STAR } from '../../../constants.js';
import { isDefaultImport } from '../../ast-helpers.js';
import { importVisitor as visit } from '../index.js';
export default visit(() => true, node => {
    if (ts.isImportDeclaration(node) && ts.isStringLiteralLike(node.moduleSpecifier)) {
        const specifier = node.moduleSpecifier.text;
        if (!node.importClause) {
            return { specifier, identifier: undefined, pos: node.pos, modifiers: IMPORT_MODIFIERS.SIDE_EFFECTS };
        }
        const imports = [];
        if (isDefaultImport(node)) {
            imports.push({
                identifier: 'default',
                alias: String(node.importClause.name?.escapedText),
                specifier,
                symbol: node.importClause.symbol,
                pos: node.importClause.name?.getStart() ?? node.getStart(),
                modifiers: IMPORT_MODIFIERS.NONE,
            });
        }
        if (node.importClause?.namedBindings) {
            if (ts.isNamespaceImport(node.importClause.namedBindings)) {
                const symbol = node.importClause.namedBindings.symbol;
                imports.push({
                    symbol,
                    specifier,
                    identifier: IMPORT_STAR,
                    pos: node.importClause.namedBindings.name.getStart(),
                    modifiers: node.importClause?.isTypeOnly ? IMPORT_MODIFIERS.TYPE_ONLY : IMPORT_MODIFIERS.NONE,
                });
            }
            if (ts.isNamedImports(node.importClause.namedBindings)) {
                for (const element of node.importClause.namedBindings.elements) {
                    const identifier = (element.propertyName ?? element.name).getText();
                    imports.push({
                        identifier,
                        specifier,
                        symbol: element.symbol,
                        pos: element.name.getStart(),
                        modifiers: node.importClause?.isTypeOnly ? IMPORT_MODIFIERS.TYPE_ONLY : IMPORT_MODIFIERS.NONE,
                    });
                }
            }
            if (imports.length === 0) {
                imports.push({
                    specifier,
                    identifier: undefined,
                    pos: node.importClause.namedBindings.pos,
                    modifiers: node.importClause?.isTypeOnly ? IMPORT_MODIFIERS.TYPE_ONLY : IMPORT_MODIFIERS.NONE,
                });
            }
        }
        return imports;
    }
});
